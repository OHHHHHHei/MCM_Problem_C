# SMC-Inverse ç³»ç»Ÿå®Œæ•´é€»è¾‘é“¾æ¡

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°åºè´¯è’™ç‰¹å¡æ´›ç²’å­æ»¤æ³¢ç³»ç»Ÿçš„å®Œæ•´é€»è¾‘é“¾æ¡ï¼ŒåŒ…æ‹¬é—®é¢˜å»ºæ¨¡ã€ç®—æ³•è®¾è®¡ã€ä»£ç å®ç°å’ŒéªŒè¯æ€è·¯ã€‚

---

## ç›®å½•

1. [é—®é¢˜å®šä¹‰](#1-é—®é¢˜å®šä¹‰)
2. [æ•°æ®å¤„ç†](#2-æ•°æ®å¤„ç†)
3. [çŠ¶æ€ç©ºé—´æ¨¡å‹](#3-çŠ¶æ€ç©ºé—´æ¨¡å‹)
4. [æ¯”èµ›è§„åˆ™å¤åˆ»](#4-æ¯”èµ›è§„åˆ™å¤åˆ»)
5. [ç²’å­æ»¤æ³¢æ¨æ–­](#5-ç²’å­æ»¤æ³¢æ¨æ–­)
6. [éªŒè¯æ¡†æ¶](#6-éªŒè¯æ¡†æ¶)
7. [ä»£ç æ¨¡å—å¯¹åº”](#7-ä»£ç æ¨¡å—å¯¹åº”)

---

## 1. é—®é¢˜å®šä¹‰

### 1.1 æ ¸å¿ƒé—®é¢˜

> **å·²çŸ¥**: æ¯å‘¨è¯„å®¡åˆ† + æœ€ç»ˆæ·˜æ±°ç»“æœ
> **æœªçŸ¥**: ç²‰ä¸æŠ•ç¥¨ä»½é¢ (ä»æœªå…¬å¼€)
> **ç›®æ ‡**: ä»æ·˜æ±°ç»“æœ"åæ¨"å‡ºéšè—çš„æŠ•ç¥¨ä»½é¢

### 1.2 é—®é¢˜å»ºæ¨¡æ€è·¯

å°†é—®é¢˜å»ºæ¨¡ä¸º**éƒ¨åˆ†è§‚æµ‹åŠ¨æ€ç³»ç»Ÿ (Partially Observable Dynamic System)**ï¼š

```
è§‚æµ‹å±‚ (Observable):
â”œâ”€â”€ è¯„å®¡åˆ† J_i,t      â† æ¯å‘¨å…¬å¼€
â””â”€â”€ æ·˜æ±°ç»“æœ E_t      â† æ¯å‘¨å…¬å¼€

éšå˜é‡å±‚ (Latent):
â”œâ”€â”€ é•¿æœŸåŸºå‡† Î¼_i,t    â† é€‰æ‰‹çš„"è·¯äººç¼˜"åŸºç¡€
â”œâ”€â”€ çŸ­æœŸåŠ¨é‡ x_i,t    â† å½“å‘¨æŠ•ç¥¨çƒ­åº¦
â””â”€â”€ æŠ•ç¥¨ä»½é¢ Ï€_i,t    â† æˆ‘ä»¬è¦åæ¨çš„ç›®æ ‡
```

### 1.3 ä¸ºä»€ä¹ˆé€‰æ‹©ç²’å­æ»¤æ³¢ï¼Ÿ

| æ–¹æ³• | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|
| å›å½’æ¨¡å‹ | ç®€å• | æ— æ³•å¤„ç†åŠ¨æ€æ¼”åŒ– |
| Kalmanæ»¤æ³¢ | é«˜æ•ˆ | è¦æ±‚çº¿æ€§é«˜æ–¯ |
| **ç²’å­æ»¤æ³¢** | éçº¿æ€§ã€ä»»æ„åˆ†å¸ƒ | è®¡ç®—é‡å¤§ |
| MCMC | ç†è®ºå®Œå¤‡ | æ— æ³•åœ¨çº¿æ¨æ–­ |

ç²’å­æ»¤æ³¢é€‚åˆæœ¬é—®é¢˜å› ä¸ºï¼š
- **éçº¿æ€§è§‚æµ‹**: æ·˜æ±°æ˜¯ç¦»æ•£äº‹ä»¶ï¼Œä¸æ˜¯é«˜æ–¯åˆ†å¸ƒ
- **åœ¨çº¿æ¨æ–­**: å¯é€å‘¨æ›´æ–°ï¼Œç¬¦åˆæ¯”èµ›æµç¨‹
- **åˆ†å¸ƒä¼°è®¡**: å¯ç»™å‡ºä¸ç¡®å®šæ€§ï¼Œè¯†åˆ«"äº‰è®®"æ·˜æ±°

---

## 2. æ•°æ®å¤„ç†

### 2.1 åŸå§‹æ•°æ®

| å­—æ®µ | è¯´æ˜ |
|------|------|
| `celebrity_name` | é€‰æ‰‹å§“å |
| `season` | èµ›å­£ç¼–å· (1-34) |
| `week{w}_judge{j}_score` | ç¬¬wå‘¨ç¬¬jä¸ªè¯„å§”åˆ†æ•° |
| `results` | ç»“æœ (æ·˜æ±°å‘¨/åæ¬¡) |

### 2.2 æ¸…æ´—æ“ä½œ

1. **ç¼ºå¤±å€¼å¤„ç†**
   - å¹´é¾„ç¼ºå¤± â†’ é»˜è®¤30
   - åˆ†æ•°ä¸ºN/Aæˆ–0 â†’ è·³è¿‡è¯¥è¯„å§”

2. **æ·˜æ±°å‘¨æå–**
   ```python
   # "Eliminated Week 5" â†’ 5
   # "1st Place" â†’ None (æœªæ·˜æ±°)
   match = re.search(r'week\s*(\d+)', result)
   ```

3. **åœ¨åœºé€‰æ‰‹åˆ¤å®š**
   ```python
   # æŸé€‰æ‰‹è¯¥å‘¨æœ‰éé›¶åˆ†æ•° â†’ åœ¨åœº
   if week in contestant.weekly_scores and any(s > 0 for s in scores):
       active.append(contestant)
   ```

4. **ç‰¹å¾å·¥ç¨‹**
   - è¡Œä¸š â†’ One-Hotç¼–ç  (7ç»´)
   - å¹´é¾„ â†’ æ ‡å‡†åŒ– (age-35)/15
   - å›½ç± â†’ äºŒå€¼ç¼–ç  (æ˜¯å¦ç¾å›½)

### 2.3 è¾“å‡ºæ ¼å¼

| æ–‡ä»¶ | å†…å®¹ |
|------|------|
| `cleaned_contestants.csv` | é€‰æ‰‹åŸºæœ¬ä¿¡æ¯ |
| `weekly_scores.csv` | æ¯å‘¨è¯„å®¡åˆ† |
| `elimination_events.csv` | æ·˜æ±°äº‹ä»¶åˆ—è¡¨ |
| `zscore_scores.csv` | æ ‡å‡†åŒ–åˆ†æ•° |

---

## 3. çŠ¶æ€ç©ºé—´æ¨¡å‹

### 3.1 é•¿æœŸåŸºå‡† Î¼ (Long-term Baseline)

**ç‰©ç†æ„ä¹‰**: é€‰æ‰‹ç¨³å®šçš„"è·¯äººç¼˜"ï¼Œå—æç«¯è¡¨æ¼”å½±å“

**æ¼”åŒ–æ–¹ç¨‹**:
```
Î¼_{i,t} = Î¼_{i,t-1} + ÎºÂ·ğŸ™(|JÌƒ|>Î´)Â·JÌƒ + Î·_t

å…¶ä¸­:
- Îº = 0.3       å†²å‡»ç³»æ•°
- Î´ = 1.5       å†²å‡»é˜ˆå€¼(æ ‡å‡†å·®)
- Î· ~ N(0, Ïƒ_Î¼) è¿‡ç¨‹å™ªå£°
- JÌƒ            æ ‡å‡†åŒ–è¯„å®¡åˆ†(Z-score)
```

**è®¾è®¡ä¾æ®**:
- åªæœ‰**æç«¯è¡¨æ¼”**(|JÌƒ|>Î´)æ‰èƒ½æ”¹å˜é•¿æœŸäººæ°”
- ç¬¦åˆç°å®ï¼šæ™®é€šè¡¨æ¼”ä¸å½±å“"è·¯äººç¼˜"

### 3.2 çŸ­æœŸåŠ¨é‡ x (Short-term Momentum)

**ç‰©ç†æ„ä¹‰**: å½“å‘¨æŠ•ç¥¨çƒ­åº¦ï¼Œå—è¡¨æ¼”å’Œè®°å¿†è¡°å‡å½±å“

**æ¼”åŒ–æ–¹ç¨‹**:
```
x_{i,t} = ÏÂ·x_{i,t-1} + (1-Ï)Â·(Î¼_{i,t} + Î³Â·JÌƒ_{i,t}) + Îµ_t

å…¶ä¸­:
- Ï = 0.6       è®°å¿†è¡°å‡ç³»æ•°(ç²‰ä¸ç²˜æ€§)
- Î³ = 0.5       è¯„å®¡å¼•å¯¼ç³»æ•°
- Îµ ~ N(0, Ïƒ_x) è¿‡ç¨‹å™ªå£°
```

**è®¾è®¡ä¾æ®**:
- **å‡å€¼å›å½’**: çƒ­åº¦è¶‹å‘é•¿æœŸåŸºå‡†
- **è¯„å®¡å¼•å¯¼**: é«˜åˆ†å¸¦æ¥çƒ­åº¦åŠ æˆ
- **è®°å¿†è¡°å‡**: ä¸Šå‘¨çƒ­åº¦æœ‰æƒ¯æ€§ä½†ä¼šè¡°å‡

### 3.3 æŠ•ç¥¨ä»½é¢ Ï€ (Vote Share)

**ä»åŠ¨é‡åˆ°ä»½é¢çš„æ˜ å°„**:
```
Ï€_{i,t} = softmax(x_t) = exp(x_{i,t}) / Î£_k exp(x_{k,t})
```

**è®¾è®¡ä¾æ®**:
- ä»½é¢å¿…é¡»å½’ä¸€åŒ– (Î£Ï€=1)
- Softmaxä¿è¯éè´Ÿä¸”å’Œä¸º1
- å·®è·å¤§çš„åŠ¨é‡äº§ç”Ÿæ‚¬æ®Šçš„ä»½é¢

### 3.4 åˆå§‹åŒ– (Expanding Window ç­–ç•¥)

**é—®é¢˜**: ç¬¬ä¸€å‘¨æ²¡æœ‰å†å²æ•°æ®ï¼Œå¦‚ä½•åˆå§‹åŒ–Î¼_0?

**è§£å†³æ–¹æ¡ˆ**: Expanding Window (æ‰©å±•çª—å£) ç­–ç•¥
```
å¯¹äºç¬¬Så­£:
1. åªç”¨ S1, S2, ..., S(s-1) è®­ç»ƒå›å½’ (ä¸¥æ ¼å°äºå½“å‰å­£)
2. é¢„æµ‹ç¬¬Så­£é€‰æ‰‹çš„åˆå§‹äººæ°”: Î¼_0 = Î²Â·ç‰¹å¾ + æˆªè·
3. åŠ å™ªå£°: Î¼_0 ~ N(é¢„æµ‹å€¼, Ïƒ_0^2)

ç‰¹æ®Šæƒ…å†µ:
- ç¬¬1å­£: æ— å†å²æ•°æ®ï¼Œä½¿ç”¨å…ˆéªŒå‡å€¼ 0.5
- ç¬¬2å­£: åªç”¨ç¬¬1å­£æ•°æ®è®­ç»ƒ
```

**ä¾æ®**:
- **ä¸¥æ ¼é¿å…æ—¶é—´æ³„éœ²**: ä¸ä½¿ç”¨ä»»ä½•æœªæ¥èµ›å­£çš„ä¿¡æ¯
- ç¬¦åˆçœŸå®é¢„æµ‹åœºæ™¯: æ¯”èµ›å¼€å§‹æ—¶åªèƒ½çœ‹åˆ°è¿‡å¾€æ•°æ®
- åˆ©ç”¨å†å²è§„å¾‹åˆå§‹åŒ–

---

## 4. æ¯”èµ›è§„åˆ™å¤åˆ»

### 4.1 è§„åˆ™ç±»å‹

| èµ›å­£ | è§„åˆ™ | è¯´æ˜ |
|------|------|------|
| S1-S2 | Rank Rule | çº¯æ’åç›¸åŠ  |
| S3-S27 | Percentage Rule | åˆ†æ•°ç™¾åˆ†æ¯” |
| S28+ | Rank + Judge Save | æ’å+è¯„å§”æ‹¯æ•‘ |

### 4.2 ç”Ÿå­˜å¾—åˆ†è®¡ç®—

**Percentage Rule (S3-S27)**:
```
S_i = (J_i / Î£_k J_k) + Ï€_i

å³: ç”Ÿå­˜åˆ† = è¯„å®¡åˆ†å æ¯”(50%) + æŠ•ç¥¨ä»½é¢(50%)
```

**Rank Rule (S1-2, S28+)**:
```
S_i = -(æ’å_è¯„å®¡ + æ’å_æŠ•ç¥¨) + Î¾Â·Ï€_i

å³: ç”Ÿå­˜åˆ† = è´Ÿæ’åå’Œ + å¾®æ‰°(æ‰“ç ´å¹³å±€)
```

#### æ’åå¹³å±€å¤„ç† (Jittering)

**é—®é¢˜**: å½“ Aã€B è¯„å®¡åˆ†éƒ½æ˜¯ 30 åˆ†æ—¶ï¼ŒPythonçš„ `sorted()` ä¼šåŸºäºå­—å…¸åºå¼ºåˆ¶åˆ†é…ä¸åŒæ’åï¼Œé€ æˆä¸å…¬å¹³ã€‚

**è§£å†³æ–¹æ¡ˆ**: æ¦‚ç‡æ€§å™ªå£°æ‰“ç ´å¹³å±€
```python
# ç»™æ¯ä¸ªåˆ†æ•°åŠ  ~1e-6 çš„éšæœºå™ªå£°
jittered = {name: score + uniform(0, 1e-6) for ...}
```

**æ•ˆæœ**:
- ç²’å­ 1: A å™ªå£° +0.0001, B å™ªå£° -0.0002 â†’ A æ’ç¬¬1
- ç²’å­ 2: A å™ªå£° -0.0003, B å™ªå£° +0.0001 â†’ B æ’ç¬¬1
- æœŸæœ›: å¹³å±€æ—¶ä¸¤äººæ’åæœŸæœ›å€¼ç›¸ç­‰

**ä¸ºä»€ä¹ˆç”¨å™ªå£°è€Œä¸æ˜¯ Average Rank**:
- æ›´ç®€å•ï¼ˆä¸€è¡Œä»£ç ï¼‰
- **å¤©ç„¶å¥‘åˆç²’å­æ»¤æ³¢**: å°†"å¹³å±€"è½¬åŒ–ä¸º"ä¸ç¡®å®šæ€§"
- åŒæ—¶è§£å†³è¯„å®¡åˆ†å’ŒæŠ•ç¥¨ä»½é¢çš„å¹³å±€é—®é¢˜

### 4.3 ç´¯åŠ è§„åˆ™ (æ— æ·˜æ±°å‘¨)

**è§„åˆ™**: å½“æŸå‘¨æ²¡æœ‰æ·˜æ±°æ—¶ï¼Œåˆ†æ•°/ä»½é¢éœ€è¦ä¸ä¸‹å‘¨ç´¯åŠ 

**ä¾‹å­** (S34 Week 5-6):
- Week 5 æ— æ·˜æ±°ï¼Œæ»¡åˆ† 40
- Week 6 æ»¡åˆ† 40
- å®é™…æ¯”è¾ƒçš„æ˜¯ä¸¤å‘¨æ€»åˆ† (æ»¡åˆ† 80)

#### è¯„å§”åˆ†ç´¯åŠ  (æ‰€æœ‰èµ›å­£)

```python
# å›æº¯æ£€æŸ¥è¿ç»­çš„æ— æ·˜æ±°å‘¨
check_week = week - 1
while check_week >= 1 and check_week not in elimination_weeks:
    # ç´¯åŠ è¯¥å‘¨åˆ†æ•°
    for c in active:
        prev_score = get_weekly_total_score(c, check_week)
        accumulated_scores[c.name] += prev_score
    check_week -= 1
```

#### æŠ•ç¥¨ä»½é¢ç´¯åŠ  (å…³é”®åŒºåˆ†)

æˆ‘ä»¬æ ¹æ®å®˜æ–¹è§„åˆ™è¯´æ˜ï¼Œä¸¥æ ¼åŒºåˆ†äº†ä¸¤ç§è§„åˆ™ä¸‹çš„ç´¯åŠ é€»è¾‘ï¼š

**1. Rank Rule (S1-2, S28+)**: **ç§¯åˆ†ç´¯åŠ  (Points Accumulation)**
- **é€»è¾‘**: æ’ååˆ†ç›´æ¥ç›¸åŠ ï¼Œè€Œä¸æ˜¯ä»½é¢ç›¸åŠ ã€‚
- **åŸå› **: é¿å…"å¤§æ¯”åˆ†è·èƒœ"çš„çº¢åˆ©è¢«ä¸å½“ä¿ç•™ã€‚ç¬¬ä¸€åæ‹¿æ»¡åˆ†ä¹‹åï¼Œå¤šä½™çš„ç¥¨æ•°ä¸åº”å¸¦å…¥ä¸‹ä¸€å‘¨ç§¯åˆ†ã€‚
- **å®ç°**: `accumulated_vote_ranks[name] += rank(current_share, reverse=True)`

**2. Percentage Rule (S3-S27)**: **ä»½é¢ç´¯åŠ  (Share Accumulation)**
- **é€»è¾‘**: æ€»ä»½é¢ï¼ˆç™¾åˆ†æ¯”ï¼‰ç›´æ¥ç›¸åŠ ã€‚
- **åŸå› **: è§„åˆ™æ˜¯ "Score = (J1+J2)/(TotalJ) + (V1+V2)/(TotalV)"ï¼Œç­‰ä»·äºä»½é¢çš„åŠ æƒå’Œã€‚
- **å®ç°**: `accumulated_shares[name] += current_share`

```python
# éå†æ¯ä¸€å‘¨
for week in sorted(all_weeks):
    # çŠ¶æ€è½¬ç§»...
    
    # æ ¹æ®è§„åˆ™ç±»å‹æ‰§è¡Œä¸åŒç´¯åŠ 
    if rule_type == 'PERCENTAGE':
        particle.accumulated_shares += current_share
    elif rule_type in ['RANK', ...]:
        # ç´¯ç§¯æ’ååˆ† (1st=1pt, 2nd=2pts...)
        particle.accumulated_vote_ranks += slope_rank(current_share)
    
    if week in elimination_weeks:
        # ä½¿ç”¨ç´¯ç§¯å€¼è®¡ç®—ä¼¼ç„¶
        likelihood(...)
        # é‡ç½®
        particle.reset_accumulation()
```

### 4.4 æ·˜æ±°é€»è¾‘

```
åŸºç¡€è§„åˆ™: ç”Ÿå­˜åˆ†æœ€ä½è€…è¢«æ·˜æ±°

S28+ Judge Save:
1. æ‰¾å‡ºBottom 2 (ç”Ÿå­˜åˆ†æœ€ä½ä¸¤äºº)
2. è¯„å§”æ ¹æ®"æŠ€æœ¯åˆ†"é€‰æ‹©æ‹¯æ•‘ä¸€äºº
3. å¦ä¸€äººæ·˜æ±°
```

#### Judge Save ä¸¤é˜¶æ®µä¼¼ç„¶

**æ¨¡å‹å®ç°**: å¯¹äº S28+ èµ›å­£ï¼Œä½¿ç”¨ä¸¤é˜¶æ®µä¼¼ç„¶å‡½æ•°ï¼š

**Stage 1: Bottom 2 æ¦‚ç‡**
```
P(B2 = {e, s}) = Î _{other âˆˆ å¹¸å­˜è€… \ B2} Ïƒ(Î±Â·(S_other - max(S_e, S_s)))

å«ä¹‰: Bottom 2 çš„æœ€é«˜åˆ†è€…ä»ä½äºæ‰€æœ‰å…¶ä»–é€‰æ‰‹
```

**Stage 2: è¯„å§”æ‹¯æ•‘æ¦‚ç‡**
```
P(Save s | B2 = {e, s}) = Ïƒ(Î²_judge Â· (J_s - J_e))

å«ä¹‰: è¯„å§”å€¾å‘æ‹¯æ•‘æŠ€æœ¯åˆ†(è¯„å®¡åˆ†)æ›´é«˜è€…
Î²_judge = 2.0 æ§åˆ¶è¯„å§”åå¥½å¼ºåº¦
```

**æ€»ä¼¼ç„¶**:
```
L = P(B2) Ã— P(Save | B2)
```

**æ•ˆæœ**: S28+ èµ›å­£å‘½ä¸­ç‡ä» 78% æå‡åˆ° **81.56%**

### 4.5 åŒæ·˜æ±°å¤„ç† (é›†åˆæ·˜æ±°)

**é—®é¢˜**: åŒæ·˜æ±°å‘¨å¦‚ä½•å¤„ç†ä¼¼ç„¶ï¼Ÿ

å¦‚æœæ‹†æˆä¸¤ä¸ªç‹¬ç«‹äº‹ä»¶ï¼š
- Event 1 (æ·˜æ±° A): è¦æ±‚ Score(A) < Score(B)
- Event 2 (æ·˜æ±° B): è¦æ±‚ Score(B) < Score(A)
- **äº’æ–¥çŸ›ç›¾ï¼** â†’ æ‰€æœ‰ç²’å­æƒé‡å´©æºƒ

**è§£å†³æ–¹æ¡ˆ**: é›†åˆæ·˜æ±°ä¼¼ç„¶ (Set-wise Likelihood)

```
L = Î _{eâˆˆæ·˜æ±°é›†} Î _{sâˆˆå¹¸å­˜é›†} Ïƒ(Î±Â·(S_s - S_e))

å«ä¹‰: æ¯ä¸ªè¢«æ·˜æ±°è€…åˆ†æ•° < æ¯ä¸ªå¹¸å­˜è€…åˆ†æ•°
æ·˜æ±°è€…å†…éƒ¨å…³ç³»ä¸é‡è¦
```

---

## 5. ç²’å­æ»¤æ³¢æ¨æ–­

### 5.1 ç²’å­çš„å«ä¹‰

æ¯ä¸ªç²’å­ä»£è¡¨ä¸€ç§"å¯èƒ½çš„ä¸–ç•Œ":
```
ç²’å­k = {
    Î¼^k = {é€‰æ‰‹1: Î¼å€¼, é€‰æ‰‹2: Î¼å€¼, ...},  # é•¿æœŸåŸºå‡†
    x^k = {é€‰æ‰‹1: xå€¼, é€‰æ‰‹2: xå€¼, ...},  # çŸ­æœŸåŠ¨é‡
    w^k = æƒé‡                              # è¿™ç§å‡è®¾çš„å¯ä¿¡åº¦
}
```

1000ä¸ªç²’å­ = 1000ç§å¯¹éšè—æŠ•ç¥¨ä»½é¢çš„çŒœæµ‹

### 5.2 æ»¤æ³¢å¾ªç¯

```
æ¯å‘¨é‡å¤:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: é¢„æµ‹ (Predict)                        â”‚
â”‚   å¯¹æ¯ä¸ªç²’å­: Î¼^k, x^k â† çŠ¶æ€æ¼”åŒ–æ–¹ç¨‹         â”‚
â”‚   è®¡ç®—: Ï€^k = softmax(x^k)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Step 2: å…ˆéªŒé¢„æµ‹ (Before Observation)         â”‚
â”‚   æ±‡æ€»ç²’å­æŠ•ç¥¨:                               â”‚
â”‚   P(iè¢«æ·˜æ±°) = Î£_k w^k Â· ğŸ™(iåœ¨ç²’å­kä¸­åˆ†æœ€ä½) â”‚
â”‚   è¾“å‡º: Top-3 å±é™©åŒº                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â•â•â•â•â•â•â• è§‚å¯ŸçœŸå®æ·˜æ±°ç»“æœ E_t â•â•â•â•â•â•â•         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Step 3: æ›´æ–° (Update)                         â”‚
â”‚   è®¡ç®—ä¼¼ç„¶: L^k = P(E_t | ç²’å­k)             â”‚
â”‚   æ›´æ–°æƒé‡: w^k â† w^k Ã— L^k                  â”‚
â”‚   å½’ä¸€åŒ–: w^k â† w^k / Î£w                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Step 4: é‡é‡‡æ · (Resample) [å¦‚ESSè¿‡ä½]        â”‚
â”‚   æ·˜æ±°ä½æƒé‡ç²’å­ï¼Œå¤åˆ¶é«˜æƒé‡ç²’å­              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Step 5: åéªŒä¼°è®¡                              â”‚
â”‚   Ï€Ì‚_i = Î£_k w^k Â· Ï€^k_i                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 ä¼¼ç„¶å‡½æ•°

**æ ¸å¿ƒæ€æƒ³**: å¦‚æœç²’å­è®¤ä¸º"Aåº”è¯¥è¢«æ·˜æ±°"ä¸”Aç¡®å®è¢«æ·˜æ±°ï¼Œè¯¥ç²’å­æƒé‡å¢å¤§

#### å•äººæ·˜æ±°ä¼¼ç„¶

**å…¬å¼**:
```
L(ç²’å­k | E=eè¢«æ·˜æ±°) = Î _{jâˆˆå¹¸å­˜è€…} Ïƒ(Î±Â·(S_j^k - S_e^k))

å…¶ä¸­:
- Ïƒ(z) = 1/(1+exp(-z))  sigmoidå‡½æ•°
- Î± = 5.0               åŒºåˆ†åº¦å‚æ•°
- S_j^k                 å¹¸å­˜è€…jåœ¨ç²’å­kä¸­çš„ç”Ÿå­˜åˆ†
- S_e^k                 è¢«æ·˜æ±°è€…eåœ¨ç²’å­kä¸­çš„ç”Ÿå­˜åˆ†
```

#### å¤šäººæ·˜æ±°ä¼¼ç„¶ (é›†åˆæ·˜æ±°)

```
L = Î _{eâˆˆæ·˜æ±°é›†} Î _{sâˆˆå¹¸å­˜é›†} Ïƒ(Î±Â·(S_s - S_e))
```

**ç›´è§‰**:
- å¦‚æœ S_j > S_e (å¹¸å­˜è€…åˆ†é«˜) â†’ Ïƒ(Â·) â‰ˆ 1 â†’ Lå¤§ â†’ ç²’å­å¯ä¿¡
- å¦‚æœ S_j < S_e (å¹¸å­˜è€…åˆ†åè€Œä½) â†’ Ïƒ(Â·) â‰ˆ 0 â†’ Lå° â†’ ç²’å­ä¸å¯ä¿¡

### 5.4 æœ‰æ•ˆæ ·æœ¬é‡ (ESS)

```
ESS = 1 / Î£_k (w^k)Â²

å¦‚æœ ESS < é˜ˆå€¼(å¦‚N/2):
  â†’ ç²’å­é€€åŒ–ä¸¥é‡ï¼Œéœ€è¦é‡é‡‡æ ·
```

### 5.5 ç³»ç»Ÿé‡é‡‡æ ·

```python
positions = (np.arange(N) + uniform(0,1)) / N
# æ ¹æ®cumsum(weights)é€‰æ‹©ç²’å­
# æƒé‡é«˜çš„ç²’å­è¢«å¤šæ¬¡å¤åˆ¶
# æƒé‡ä½çš„ç²’å­è¢«æ·˜æ±°
```

---

## 6. éªŒè¯æ¡†æ¶

### 6.1 éªŒè¯æ€è·¯

**æ ¸å¿ƒé—®é¢˜**: æˆ‘ä»¬æ²¡æœ‰"çœŸå®"æŠ•ç¥¨ä»½é¢ï¼Œå¦‚ä½•éªŒè¯æ¨¡å‹ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: ç”¨**é¢„æµ‹èƒ½åŠ›**é—´æ¥éªŒè¯
- å¦‚æœæ¨¡å‹å¯¹éšå˜é‡çš„ä¼°è®¡æ˜¯å‡†ç¡®çš„
- é‚£ä¹ˆåŸºäºä¼°è®¡çš„**é¢„æµ‹**åº”è¯¥ä¹Ÿæ˜¯å‡†ç¡®çš„

### 6.2 é¢„æµ‹æ€§éªŒè¯ (ä¸»è¦æŒ‡æ ‡)

#### Top-N å‘½ä¸­ç‡

**å®šä¹‰**:
```
å‘½ä¸­ç‡ = Î£ ğŸ™(è¢«æ·˜æ±°è€… âˆˆ é¢„æµ‹Top-Nå±é™©åŒº) / æ·˜æ±°äº‹ä»¶æ€»æ•°
```

**å…³é”®ç‚¹**:
- é¢„æµ‹åœ¨**è§‚å¯Ÿæ·˜æ±°å‰**åšå‡º (çœŸæ­£çš„out-of-sampleé¢„æµ‹)
- ä¸ä½¿ç”¨æœªæ¥æ•°æ® (Expanding Windowç¡®ä¿åˆå§‹åŒ–ä¹Ÿä¸æ³„éœ²)

**å½“å‰ç»“æœ**:

| æŒ‡æ ‡ | å‘½ä¸­ç‡ | éšæœºåŸºçº¿ |
|------|--------|----------|
| Top-1 | 35.57% | ~10% |
| Top-3 | 77.18% | ~30% |

#### å„èµ›å­£åˆ†è§£

| è§„åˆ™ç±»å‹ | å¹³å‡å‘½ä¸­ç‡ |
|----------|-----------|
| Percentage (S3-S27) | 77.65% |
| Rank (S1-2, S28+) | 78.11% |

ä¸¤ç§è§„åˆ™ä¸‹è¡¨ç°ç›¸å½“ï¼Œè¯´æ˜æ¨¡å‹å¯¹è§„åˆ™çš„ç†è§£æ˜¯æ­£ç¡®çš„ã€‚

### 6.3 ä¸€è‡´æ€§éªŒè¯ (Reconstructability)

**æ ¸å¿ƒé—®é¢˜**: æ¨¡å‹ä¸ä»…è¦èƒ½"é¢„æµ‹"æœªæ¥ï¼Œè¿˜è¦èƒ½"è¿˜åŸ"å†å²ã€‚ä¼°è®¡å‡ºçš„æŠ•ç¥¨ä»½é¢æ˜¯å¦ç¬¦åˆç‰©ç†é€»è¾‘ï¼ˆå³æ¯”èµ›è§„åˆ™ï¼‰ï¼Ÿ

#### 1. åéªŒä¸€è‡´æ¦‚ç‡ (Posterior Consistency Probability)

**å®šä¹‰**:
```
P(Consistent) = Î£_k w^k Â· ğŸ™(Rule(J, Ï€^k) == E_actual)
```

**å«ä¹‰**: åœ¨è§‚æµ‹åˆ°æ·˜æ±°ç»“æœå¹¶æ›´æ–°æƒé‡åï¼Œå‰©ä¸‹çš„ç²’å­ä¸­æœ‰å¤šå°‘æ¯”ä¾‹ï¼ˆåŠ æƒï¼‰è®¤ä¸º"ç¡®å®è¯¥æ·˜æ±°è¿™ä¸ªäºº"ã€‚
- è¿™æ˜¯ä¸€ä¸ª**è½¯æ€§æŒ‡æ ‡**ï¼Œè¡¡é‡æ¦‚ç‡åˆ†å¸ƒå±‚é¢çš„è‡ªæ´½æ€§ã€‚
- **å®æµ‹ç»“æœ**: ~48.7% (è¯´æ˜è¿‘ä¸€åŠçš„å¹³è¡Œä¸–ç•Œå®Œç¾å¤åˆ»äº†å†å²)

#### 2. MAPä¸€è‡´ç‡ (MAP Match Rate)

**å®šä¹‰**:
å°†æ¨¡å‹ä¼°è®¡çš„**åéªŒå‡å€¼** (Point Estimate) ä»£å…¥æ¯”èµ›è§„åˆ™ï¼Œè®¡ç®—ç†è®ºä¸Šçš„æ·˜æ±°è€…ï¼Œä¸çœŸå®ç»“æœå¯¹æ¯”ã€‚
```
Ï€Ì‚ = E[Ï€ | Data]
Match = ğŸ™(Rule(J, Ï€Ì‚) == E_actual)
```

**å«ä¹‰**:
- è¿™æ˜¯ä¸€ä¸ª**ç¡¬æ€§æŒ‡æ ‡**ã€‚
- ç›´æ¥å›ç­”: "ç”¨ä½ ç®—å‡ºæ¥çš„ç¥¨æ•°å»è·‘è§„åˆ™ï¼Œèƒ½ä¸èƒ½ç®—å‡ºæ­£ç¡®çš„ç»“æœï¼Ÿ"
- **å®æµ‹ç»“æœ**: ~51.1% (è¶…è¿‡ä¸€åŠçš„æ·˜æ±°äº‹ä»¶å¯ä»¥è¢«æ•°å­¦æ¨¡å‹ç²¾ç¡®è¿˜åŸ)

---

### 6.4 è§£é‡Šæ€§éªŒè¯

#### äº‰è®®å¾—åˆ†

**å®šä¹‰**:
```
äº‰è®®å¾—åˆ† = -log(ä¼¼ç„¶)
```

**è§£é‡Š**:
- ä¼¼ç„¶æä½ â†’ æ¨¡å‹è®¤ä¸º"ä¸è¯¥æ·˜æ±°è¯¥é€‰æ‰‹"
- è¿™äº›æ˜¯æ½œåœ¨çš„"çˆ†å†·"æˆ–"äº‰è®®"äº‹ä»¶

**éªŒè¯**: äº‰è®®å¾—åˆ†é«˜çš„æ·˜æ±° vs å·²çŸ¥äº‰è®®äº‹ä»¶
- å¦‚ Melanie C (S30), Christine Chiu (S30) éƒ½æœ‰é«˜äº‰è®®å¾—åˆ†
- ä¸å…¬ä¼—èˆ†è®ºä¸€è‡´

### 6.5 å…¬å¹³æ€§åˆ†æ

#### ç¿»ç›˜ç‡ (Flip Rate)

**å®šä¹‰**: å¦‚æœä½¿ç”¨å¦ä¸€ç§è§„åˆ™ï¼Œæœ‰å¤šå°‘æ¯”ä¾‹çš„æ·˜æ±°ç»“æœä¼šæ”¹å˜

**æ„ä¹‰**: è¡¡é‡è§„åˆ™å¯¹ç»“æœçš„å½±å“ç¨‹åº¦

#### æ°‘ç²¹åå·® (Populist Bias)

**å®šä¹‰**:
```
Bias = E[Rank_æŠ•ç¥¨(å¹¸å­˜è€…) - Rank_è¯„å®¡(å¹¸å­˜è€…)]
```

**è§£é‡Š**:
- Bias > 0: è§„åˆ™åå‘é«˜äººæ°”é€‰æ‰‹
- Bias < 0: è§„åˆ™åå‘é«˜æŠ€æœ¯é€‰æ‰‹
- Bias â‰ˆ 0: è§„åˆ™ç›¸å¯¹å¹³è¡¡

**å®æµ‹ç»“æœ**: ä¸¤ç§è§„åˆ™çš„Biaséƒ½ç•¥ä¸ºè´Ÿ (-0.11~-0.15)ï¼Œè¯´æ˜éƒ½ç•¥åå‘æŠ€æœ¯é€‰æ‰‹

---

## 7. ä»£ç æ¨¡å—å¯¹åº”

| é€»è¾‘å±‚ | ä»£ç æ–‡ä»¶ | ä¸»è¦å‡½æ•°/ç±» |
|--------|----------|-------------|
| æ•°æ®åŠ è½½ | `data_processor.py` | `DataProcessor` |
| ç‰¹å¾å·¥ç¨‹ | `data_processor.py` | `get_feature_vector()` |
| Z-Score | `data_processor.py` | `compute_zscore_scores()` |
| è§„åˆ™è®¡ç®— | `competition_rules.py` | `CompetitionRules` |
| ä¼¼ç„¶è®¡ç®— | `competition_rules.py` | `LikelihoodCalculator` |
| çŠ¶æ€æ¼”åŒ– | `smc_inverse.py` | `_state_transition()` |
| æŠ•ç¥¨ä»½é¢ | `smc_inverse.py` | `_compute_vote_shares()` |
| ç²’å­æ»¤æ³¢ | `smc_inverse.py` | `run_season()` |
| é‡é‡‡æ · | `smc_inverse.py` | `_resample()` |
| å‘½ä¸­éªŒè¯ | `analysis.py` | `compute_overall_hit_rate()` |
| äº‰è®®è¯†åˆ« | `analysis.py` | `identify_controversies()` |
| ä¸»ç¨‹åº | `main.py` | `run_model()` |

---

## 8. æ€»ç»“

### ä¿¡æ¯æµå›¾

```
è¾“å…¥                    éšå˜é‡å±‚                   è¾“å‡º
â”€â”€â”€â”€                   â”€â”€â”€â”€â”€â”€â”€                   â”€â”€â”€â”€
                           â”‚
è¯„å®¡åˆ† J â”€â”€â†’ çŠ¶æ€æ¼”åŒ– â”€â”€â†’ Î¼, x â”€â”€â†’ softmax â”€â”€â†’ Ï€
                           â”‚
                      è®¡ç®—ç”Ÿå­˜åˆ† S
                           â”‚
                      ä¼¼ç„¶æ›´æ–°æƒé‡
                           â”‚
æ·˜æ±°ç»“æœ E â†â”€â”€â”€â”€â”€â”€â”€â”€ ç²’å­é‡é‡‡æ ·
                           â”‚
                      åéªŒä¼°è®¡ Ï€Ì‚
                           â”‚
                      éªŒè¯: å‘½ä¸­ç‡
```

### éªŒè¯ç»“è®º

1. **77.18%** çš„ Top-3 å‘½ä¸­ç‡è¯æ˜æ¨¡å‹æœ‰æ•ˆ
2. **35.57%** çš„ Top-1 å‘½ä¸­ç‡è¿œè¶…éšæœºåŸºçº¿ (~10%)
3. **~50%** çš„ä¸€è‡´æ€§æŒ‡æ ‡ (Posterior/MAP) è¯æ˜æ¨¡å‹èƒ½æœ‰æ•ˆè¿˜åŸå†å²
4. äº‰è®®å¾—åˆ†ä¸å…¬ä¼—èˆ†è®ºä¸€è‡´
5. ä¸¤ç§è§„åˆ™çš„å…¬å¹³æ€§ç›¸å½“ (éƒ½ç•¥åæŠ€æœ¯)
6. æ¨¡å‹å¯ç”¨äºåˆ†æè§„åˆ™å˜æ›´çš„åäº‹å®å½±å“
568: 
569: ### 7. æ¨¡å‹æ ¡å‡† (Model Calibration)
570: 
571: æ—¢ç„¶æ²¡æœ‰çœŸå®çš„ç²‰ä¸æŠ•ç¥¨æ•°æ®ä½œä¸º Ground Truthï¼Œæˆ‘ä»¬é‡‡ç”¨**â€œä»¥è§‚æµ‹ç»“æœä¸ºé”šç‚¹çš„é€†å‘æ ¡å‡†â€**ç­–ç•¥ã€‚
572: 
573: #### 7.1 ä¼˜åŒ–ç›®æ ‡
574: å¯»æ‰¾ä¸€ç»„è¶…å‚æ•° $\theta = \{\rho, \gamma, \alpha, ...\}$ï¼Œæœ€å¤§åŒ–æ¨¡å‹å¯¹å†å²æ·˜æ±°äº‹ä»¶çš„è§£é‡ŠåŠ›ï¼š
575: 
576: $$Score(\theta) = w_1 \cdot \text{HitRate}_{Top3} + w_2 \cdot \text{MatchRate}_{MAP} + w_3 \cdot \text{Consistency}_{Posterior}$$
577: 
578: - **HitRate**: é¢„æµ‹å‡†ç¡®åº¦ï¼ˆå‡†ä¸å‡†ï¼Ÿï¼‰
579: - **MatchRate**: æœºåˆ¶è¿˜åŸåº¦ï¼ˆå¯¹ä¸å¯¹ï¼Ÿï¼‰
580: - **Consistency**: å†…åœ¨è‡ªæ´½æ€§ï¼ˆç¨³ä¸ç¨³ï¼Ÿï¼‰
581: 
582: #### 7.2 å…³é”®å‚æ•°
583: - **è®°å¿†è¡°å‡ $\rho$**: å†³å®šè§‚ä¼—è®°å¿†é•¿åº¦ã€‚ä¼˜åŒ–åå¸¸åœ¨ $[0.6, 0.7]$ åŒºé—´ï¼Œç¬¦åˆå¿ƒç†å­¦é—å¿˜æ›²çº¿ã€‚
584: - **è¯„å®¡å¼•å¯¼ $\gamma$**: å†³å®šâ€œä»ä¼—å¿ƒç†â€å¼ºåº¦ã€‚ä¼˜åŒ–å $\gamma > 0$ è¯æ˜äº†è¯„å®¡å¯¹èˆ†è®ºçš„æ˜¾è‘—å¼•å¯¼ä½œç”¨ã€‚
585: - **åˆ¤åˆ«åŠ› $\alpha$**: å†³å®šæ·˜æ±°æ¦‚ç‡çš„é™¡å³­ç¨‹åº¦ã€‚
586: 
587: è¿™ä¸€æ ¡å‡†è¿‡ç¨‹å°†å¯å‘å¼å‚æ•°è½¬åŒ–ä¸º**æ•°æ®é©±åŠ¨çš„æœ€ä¼˜è§£**ï¼Œå¤§å¹…æå‡äº†è®ºæ–‡çš„è¯´æœåŠ›ã€‚
