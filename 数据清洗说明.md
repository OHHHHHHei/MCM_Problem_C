# 数据清洗说明

本文档描述 `data_processor.py` 中对原始数据 `2026_MCM_Problem_C_Data.csv` 进行的预处理操作。

---

## 1. 原始数据概览

| 字段 | 说明 | 示例 |
|------|------|------|
| `celebrity_name` | 选手姓名 | "Bobby Bones" |
| `ballroom_partner` | 舞伴 | "Sharna Burgess" |
| `celebrity_industry` | 行业 | "Radio Personality" |
| `celebrity_homestate` | 家乡州 | "Arkansas" |
| `celebrity_homecountry/region` | 国家 | "United States" |
| `celebrity_age_during_season` | 年龄 | 38 |
| `season` | 赛季 | 27 |
| `results` | 结果 | "1st Place" / "Eliminated Week 5" |
| `placement` | 最终名次 | 1-16 |
| `week1_judge1_score` ... | 每周评审分 | 7, 8, N/A, 0 |

---

## 2. 数据清洗操作

### 2.1 缺失值处理

| 字段 | 处理方式 |
|------|----------|
| `homestate` | 允许为空 (外国选手) |
| `homecountry` | 缺失时设为 `"Unknown"` |
| `age` | 缺失时设为默认值 `30` |
| `placement` | 缺失时设为 `99` (未排名) |

```python
# 代码示例
age = row['celebrity_age_during_season']
if pd.isna(age):
    age = 30  # 默认年龄
```

### 2.2 评审分处理

**原始数据问题**:
- `N/A` 字符串表示该评委未参与
- `0` 表示该周未参赛
- 部分分数为小数 (如 `8.5`, `9.6666`)

**处理逻辑**:
```python
for week in range(1, 12):  # 最多11周
    scores = []
    for judge in range(1, 5):  # 4个评委
        val = row[f'week{week}_judge{judge}_score']
        
        # 跳过无效值
        if pd.isna(val) or val == 'N/A' or val == 0:
            continue
            
        scores.append(float(val))
    
    # 只保留有效周 (至少有一个非零分)
    if scores and any(s > 0 for s in scores):
        weekly_scores[week] = scores
```

### 2.3 淘汰周解析

从 `results` 字段提取淘汰周数:

| 原始值 | 解析结果 |
|--------|----------|
| `"Eliminated Week 5"` | `week = 5` |
| `"1st Place"` | `week = None` (未被淘汰) |
| `"Withdrew"` | `week = None` (主动退出) |

```python
import re

result = contestant.result.lower()

if 'withdrew' in result:
    return None  # 主动退出不计入淘汰

match = re.search(r'week\s*(\d+)', result, re.IGNORECASE)
if match:
    return int(match.group(1))
```

### 2.4 在场选手判定

判断选手某周是否仍在场:

```python
def get_active_contestants(season, week):
    """获取某周仍在场的选手"""
    active = []
    for contestant in season_contestants:
        if week in contestant.weekly_scores:
            scores = contestant.weekly_scores[week]
            # 必须有有效(非零)分数
            if scores and any(s > 0 for s in scores):
                active.append(contestant)
    return active
```

---

## 3. 特征工程

### 3.1 行业编码 (One-Hot)

```python
industries = [
    'Actor/Actress',
    'Athlete', 
    'Singer/Rapper',
    'TV Personality',
    'Model',
    'Comedian',
    'Other'
]

# 匹配行业
for i, ind in enumerate(industries):
    if ind.lower() in contestant.industry.lower():
        industry_code[i] = 1
        break
```

### 3.2 年龄标准化

```python
age_norm = (age - 35) / 15  # 均值约35，标准差约15
```

### 3.3 国籍编码

```python
is_us = 1.0 if homecountry == 'United States' else 0.0
```

### 3.4 特征向量

最终特征向量 (9维):
```
[age_norm, is_us, Actor, Athlete, Singer, TV, Model, Comedian, Other]
```

---

## 4. 评审分标准化 (Z-Score)

为了跨周可比，对每周评审分进行标准化:

```python
def compute_zscore_scores(season, week):
    scores = {选手: 平均分}
    
    mean = np.mean(list(scores.values()))
    std = np.std(list(scores.values()))
    
    return {name: (s - mean) / std for name, s in scores.items()}
```

---

## 5. 数据统计

清洗后的数据概览:

| 统计项 | 数值 |
|--------|------|
| 总赛季数 | 34 |
| 总选手数 | 421 |
| 总淘汰事件 | 298 |
| 平均每季选手 | 12.4 |
| 平均每季淘汰 | 8.8 |

---

## 6. 特殊情况处理

| 情况 | 处理 |
|------|------|
| 双淘汰周 | 计为2个独立淘汰事件 |
| 主动退赛 (Withdrew) | 不计入淘汰事件 |
| 无淘汰周 | 触发分数滚存逻辑 |
| 评委人数变化 | 自动适应 (1-4人) |
| 分数格式混乱 | 强制转float，失败则跳过 |
